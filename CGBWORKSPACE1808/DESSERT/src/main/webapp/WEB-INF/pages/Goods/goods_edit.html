<!-- Horizontal Form -->
<div class="box box-info">
	<div class="box-header with-border">
		<h3 class="box-title">添加商品</h3>




	</div>
	<!-- /.box-header -->
	<!-- form start -->
	<form class="form-horizontal">
		<div class="box-body">

			<div class="form-group">
				<label for="nameId" class="col-sm-2 control-label">商品名称</label>

				<div class="col-sm-10">
					<input type="text" class="form-control" name="name" id="nameId"
						placeholder="商品名称">
				</div>
			</div>


			<div class="form-group">
				<label for="priceId" class="col-sm-2 control-label">商品价格</label>

				<div class="col-sm-10">
					<input type="text" class="form-control" name="price" id="priceId"
						placeholder="商品价格">
				</div>
			</div>



			<div class="form-group">
				<label for="categoryId" class="col-sm-2 control-label">商品类型</label>
				<div class="col-sm-10">
					<input type="text" class="form-control" name="category"
						id="categoryId" placeholder="商品类型">
				</div>
			</div>


			<!-- <div class="form-group">
            <label for="categoryId" class="col-sm-2 control-label">选择图片</label>
            <div class="col-sm-10">
            <span>
				指定 multiple="multiple" 属性，可以选择多个文件
				<input type="file" id="images"multiple="multiple">
				<input id="ajax_upload" type="button" value="ajax上载">
             </span>
			<div id="selected"></div>
            </div>
          </div>  -->
			<div class="form-group">
				<label for="imageId" class="col-sm-2 control-label">图片地址</label>
				<div class="col-sm-10">
					<input type="text" class="form-control" name="image" id="imageId"
						placeholder="图片地址">
				</div>
			</div>
			<!--  <div class="form-group">
				<label class="col-sm-2 control-label">授权</label>
				<div class="col-sm-10">
						<ul id="menuTree" class="ztree"></ul>
				</div>
		  </div> -->
		</div>
		<!-- /.box-body -->
		<div class="box-footer">
			<button type="button" class="btn btn-default btn-cancel">Cancel</button>
			<button type="button" class="btn btn-info pull-right btn-save">Save</button>
		</div>
		<!-- /.box-footer -->
	</form>
</div>
<script type="text/javascript"
	src="bower_components/ztree/jquery.ztree.all.min.js"></script>
<script type="text/javascript" src="bower_components/layer/layer.js"></script>
<script type="text/javascript">
	/*  var btn=document.getElementById("ajax_upload");
	 btn.onclick=function(){
	     var files = images.files;
	     var frm = new FormData();//空白表单
	     //将文件添加到frm中
	     for(var i=0; i<files.length; i++){
	         var f = files[i];
	         frm.append("images", f, f.name);
	     }
	     //发起Ajax请求
	     btn.value = "上载中...";
	     var xhr = new XMLHttpRequest();
	     xhr.open("post", "goods/uploadImages.do");
	     xhr.onreadystatechange = function(){
	         if(xhr.readyState==4&&xhr.status==200){
	             var json=JSON.parse(xhr.responseText);
	             console.log(json);
	             selected.innerHTML=json.message;
	             btn.value = "ajax上载";
	         }
	     };
	     xhr.send(frm); 
	 };  
	 */

	/*   var zTree; 
	var setting = {
	data : {
	    simpleData : {
			enable : true,
			idKey : "id",  //节点数据中保存唯一标识的属性名称
			pIdKey : "parentId",  //节点数据中保存其父节点唯一标识的属性名称
			rootPId : null  //根节点id
		}
	},
	check:{
		enable:true,
		nocheckInherit:true
	}//此配置提供复选框操作(可查官方zTree)
	}
	//页面加载完成时初始化zTree
	function doLoadSysMenus(){
		var url="menu/doFindZtreeMenuNodes.do"
		$.getJSON(url,function(result){
		 if(result.state==1){
			zTree=$.fn.zTree.init(
			$("#menuTree"),setting,result.data);
			//修改时添加如下代码(注意先后顺序)
			var rowData=$("#mainContentId").data("data");
		    if(rowData)doInitEditFormData(rowData);
		 }else{
			alert(result.message);
		 }
	});
	}  */

	/*  =======*/
	$(function() {
		//异步加载菜单信息,初始化页面菜单
		//doLoadSysMenus();
		var rowData = $("#mainContentId").data("data");
		if (rowData)
			doInitEditFormData(rowData);

		$(".box-footer").on("click", ".btn-save", doSaveOrUpdate).on("click",
				".btn-cancel", doCancel);

	});
	//更新
	function doInitEditFormData(data) {
		//debugger
		//console.log("data",data);
		//1.初始化角色自身信息

		$("#nameId").val(data.goods.name);
		$("#priceId").val(data.goods.price);
		$("#categoryId").val(data.goods.category);
		$("#imageId").val(data.goods.image);
		/* //2.初始化菜单信息
		//2.1展开树节点
		zTree.expandAll(true);
		//2.2获取角色对应的菜单id
		var menuIds=data.menuIds;
		//2.3迭代所有菜单id
		for(var i in menuIds){
		  //基于菜单id获取ztree中的node节点
		  var node=
		  zTree.getNodeByParam("id",menuIds[i]);
		  //让节点选中
		  zTree.checkNode(node,true,false);
		} */
	}
	function doCancel() {
		var url = "goods/doGoodUI.do";
		$("#mainContentId").load(url, function() {
			//移除绑定数据（修改时用）
			$("#mainContentId").removeData();
		});
	}

	function doSaveOrUpdate() {
		//debugger
		//1.参数(表单数据)

		var params = doGetEditFormData();
		console.log("params=" + params)
		/*  if(!params.name.trim()){
			alert("角色名不能为空");
			return;
		}
		if(!params.menuIds.trim()){
			alert("请为角色赋予权限")
			return;
		}
		 */

		//2.url */
		var data = $("#mainContentId").data("data");
		console.log("data=", data)
		if (data)
			params.id = data.goods.id;//data.role.id; 
		//console.log(data);
		var insertUrl = "goods/dosaveObject.do";
		var updateUrl = "goods/doUpdataObject.do";
		var url = data ? updateUrl : insertUrl;
		//3.ajax request
		$.post(url, params, function(result) {
			//console.log(params);
			if (result.state == 1) {
				layer.alert(result.message);
				doCancel();
			} else {
				layer.alert(result.message);
			}
		})
	}
	//添加

	function doGetEditFormData() {
		//1.获取角色自身信息
		var params = {

			name : $("#nameId").val(),
			price : $("#priceId").val(),
			category : $("#categoryId").val(),
			image : $("#imageId").val()

		}
		/* //2.获取选中菜单信息
		var menuIds=[];
		console.log(zTree)
		var checkedNodes=
		zTree.getCheckedNodes(true);
		for(var i in checkedNodes){
			menuIds.push(checkedNodes[i].id);
		}
		params.menuIds=menuIds.toString(); */
		return params;
	}
</script>







